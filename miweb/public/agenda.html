<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agenda avan√ßada - Oriol</title>

  <style>
    :root {
      --bg: #f4f5f7;
      --card-bg: #ffffff;
      --accent: #4a7aff;
      --accent-soft: #dce6ff;
      --text-main: #1f2933;
      --text-soft: #6b778c;
      --border-soft: #d8e2ec;
      --danger: #ff4d4d;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.12);
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    a.enllac {
      position: fixed;
      top: 10px;
      left: 10px;
      text-decoration: none;
      font-size: 0.9rem;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      color: var(--text-main);
      box-shadow: 0 4px 12px rgba(15,23,42,0.15);
      z-index: 20;
    }

    a.enllac:hover {
      background: #e5edff;
      color: var(--accent);
    }

    header {
      padding: 60px 20px 20px;
      text-align: center;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 2.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    header p {
      margin: 0;
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    main {
      padding: 10px 16px 30px;
      max-width: 1180px;
      width: 100%;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-soft);
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
    }

    /* CALENDARI */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-header h3 {
      margin: 0;
      font-size: 1.15rem;
    }

    .calendar-nav button {
      border: none;
      background: transparent;
      padding: 4px 10px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--text-soft);
      font-size: 0.9rem;
    }

    .calendar-nav button:hover {
      background: #edf2ff;
      color: var(--accent);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      font-size: 0.82rem;
    }

    .calendar-day-name {
      text-align: center;
      color: var(--text-soft);
      font-weight: 600;
      padding-bottom: 4px;
    }

    .calendar-day {
      height: 44px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: 0.15s;
    }

    .calendar-day.other-month {
      opacity: 0.35;
    }

    .calendar-day.has-events::after {
      content: "";
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .calendar-day.today {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px var(--accent-soft);
      font-weight: 600;
    }

    .calendar-day.selected {
      background: var(--accent);
      color: white;
    }

    .calendar-day:hover {
      background: #e5edff;
    }

    /* FORMULARI ESDEVENIMENT */
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    label {
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: left;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
      background: #f9fbff;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .row {
      display: flex;
      gap: 8px;
    }

    .row > div {
      flex: 1;
    }

    .label-inline {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .selected-date {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .btn-primary {
      border: none;
      padding: 9px 14px;
      border-radius: 999px;
      background: var(--accent);
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      margin-top: 4px;
      align-self: flex-end;
    }

    .btn-primary:hover {
      background: #335dff;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 3px;
    }

    /* LLISTA ESDEVENIMENTS */
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .filters input {
      max-width: 200px;
    }

    .category-pill {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.75rem;
      border: 1px solid var(--border-soft);
      cursor: pointer;
      background: #f7f9fb;
      color: var(--text-soft);
    }

    .category-pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
    }

    .events-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .event-card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 10px 12px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 8px;
      align-items: center;
      border: 1px solid transparent;
      transition: 0.15s;
    }

    .event-card:hover {
      border-color: var(--accent-soft);
      background: #ffffff;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.07);
    }

    .event-date {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .event-title {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 0.95rem;
    }

    .event-desc {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .event-meta {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .chip {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef2ff;
      color: #4c6fff;
      margin-left: 6px;
    }

    .event-actions button {
      border: none;
      background: transparent;
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--text-soft);
      padding: 0 5px;
    }

    .event-actions button:hover {
      color: var(--danger);
    }

    .empty-state {
      text-align: center;
      padding: 12px;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    /* Scroll bar suau */
    .events-list::-webkit-scrollbar {
      width: 6px;
    }

    .events-list::-webkit-scrollbar-thumb {
      background: #cbd2e1;
      border-radius: 999px;
    }
  </style>
</head>

<body>
  <a href="index.html" class="enllac">‚Üê Tornar a la portada</a>

  <header>
    <h1>AGENDA AVAN√áADA</h1>
    <p>Organitza els teus estudis, projectes i vida personal en un sol lloc.</p>
  </header>

  <main>
    <!-- COLUMNA ESQUERRA: CALENDARI + FORMULARI -->
    <section class="card">
      <div class="card-header">
        <h2>Calendari</h2>
        <div class="pill" id="todayLabel"></div>
      </div>

      <div class="calendar-header">
        <h3 id="monthLabel"></h3>
        <div class="calendar-nav">
          <button id="prevMonth">‚Üê Anterior</button>
          <button id="nextMonth">Seg√ºent ‚Üí</button>
        </div>
      </div>

      <div class="calendar-grid" id="calendarGrid">
        <!-- Dies generats amb JS -->
      </div>

      <hr style="margin:16px 0; border:none; border-top:1px solid var(--border-soft);" />

      <div class="card-header" style="margin-bottom: 4px;">
        <h2>Nou esdeveniment</h2>
        <span class="pill" id="selectedDateLabel"></span>
      </div>

      <form id="eventForm">
        <div>
          <label for="title">T√≠tol</label>
          <input id="title" type="text" placeholder="Ex: Examen de mates, Deures, Entrenament..." required />
        </div>

        <div>
          <label for="description">Descripci√≥</label>
          <textarea id="description" placeholder="Detalls, objectius, material que necessites, etc."></textarea>
        </div>

        <div class="row">
          <div>
            <label class="label-inline" for="time">
              Hora
              <span class="hint">(opcional)</span>
            </label>
            <input id="time" type="time" />
          </div>

          <div>
            <label for="category">Categoria</label>
            <select id="category">
              <option value="totes">Sense categoria</option>
              <option value="estudis">Estudis</option>
              <option value="personal">Personal</option>
              <option value="projectes">Projectes</option>
              <option value="altres">Altres</option>
            </select>
          </div>
        </div>

        <button class="btn-primary" type="submit">Desar esdeveniment</button>
      </form>
      <p class="hint">Els esdeveniments es guarden autom√†ticament al navegador (localStorage).</p>
    </section>

    <!-- COLUMNA DRETA: FILTRES + LLISTA ESDEVENIMENTS -->
    <section class="card">
      <div class="card-header">
        <h2>Esdeveniments</h2>
        <span class="pill" id="eventsCount">0 esdeveniments</span>
      </div>

      <div class="filters">
        <input id="searchInput" type="text" placeholder="Cercar per t√≠tol o descripci√≥..." />
        <div style="display:flex; gap:6px; flex-wrap:wrap;">
          <button class="category-pill active" data-filter="totes">Totes</button>
          <button class="category-pill" data-filter="estudis">Estudis</button>
          <button class="category-pill" data-filter="personal">Personal</button>
          <button class="category-pill" data-filter="projectes">Projectes</button>
          <button class="category-pill" data-filter="altres">Altres</button>
        </div>
      </div>

      <div class="events-list" id="eventsList">
        <!-- Targetes generades amb JS -->
      </div>
    </section>
  </main>

  <script>
    // --- UTILITATS DE DATA ---
    const monthNames = [
      "Gener", "Febrer", "Mar√ß", "Abril", "Maig", "Juny",
      "Juliol", "Agost", "Setembre", "Octubre", "Novembre", "Desembre"
    ];
    const weekDays = ["Dl", "Dt", "Dc", "Dj", "Dv", "Ds", "Dg"];

    function formatDateKey(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function formatDatePretty(date) {
      return `${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`;
    }

    // --- ESTAT ---
    let currentDate = new Date();
    let selectedDate = new Date();

    let events = []; // { id, dateKey, title, description, time, category }

    const STORAGE_KEY = "oriol_agenda_events_v1";

    // --- ELEMENTS DOM ---
    const todayLabel = document.getElementById("todayLabel");
    const monthLabel = document.getElementById("monthLabel");
    const calendarGrid = document.getElementById("calendarGrid");
    const selectedDateLabel = document.getElementById("selectedDateLabel");

    const prevMonthBtn = document.getElementById("prevMonth");
    const nextMonthBtn = document.getElementById("nextMonth");

    const eventForm = document.getElementById("eventForm");
    const titleInput = document.getElementById("title");
    const descInput = document.getElementById("description");
    const timeInput = document.getElementById("time");
    const categorySelect = document.getElementById("category");

    const searchInput = document.getElementById("searchInput");
    const categoryPills = document.querySelectorAll(".category-pill");
    const eventsList = document.getElementById("eventsList");
    const eventsCount = document.getElementById("eventsCount");

    let currentFilterCategory = "totes";
    let currentSearch = "";

    // --- LOCAL STORAGE ---
    function loadEvents() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          events = JSON.parse(saved);
        } catch {
          events = [];
        }
      }
    }

    function saveEvents() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    // --- CALENDARI ---
    function renderCalendar() {
      calendarGrid.innerHTML = "";

      // files de noms de dies
      weekDays.forEach(d => {
        const div = document.createElement("div");
        div.className = "calendar-day-name";
        div.textContent = d;
        calendarGrid.appendChild(div);
      });

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      monthLabel.textContent = `${monthNames[month]} ${year}`;

      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);
      const startDay = (firstDayOfMonth.getDay() + 6) % 7; // dilluns = 0

      const daysInPrevMonth = new Date(year, month, 0).getDate();
      const totalCells = 42; // 6 files de 7

      const todayKey = formatDateKey(new Date());
      const selectedKey = formatDateKey(selectedDate);

      for (let i = 0; i < totalCells; i++) {
        const cell = document.createElement("button");
        cell.type = "button";
        cell.className = "calendar-day";

        let dayNumber;
        let cellMonth = month;
        let cellYear = year;
        let isOtherMonth = false;

        if (i < startDay) {
          // dies del mes anterior
          dayNumber = daysInPrevMonth - (startDay - 1 - i);
          cellMonth = month - 1;
          if (cellMonth < 0) {
            cellMonth = 11;
            cellYear = year - 1;
          }
          isOtherMonth = true;
        } else if (i >= startDay + lastDayOfMonth.getDate()) {
          // dies del mes seg√ºent
          dayNumber = i - (startDay + lastDayOfMonth.getDate()) + 1;
          cellMonth = month + 1;
          if (cellMonth > 11) {
            cellMonth = 0;
            cellYear = year + 1;
          }
          isOtherMonth = true;
        } else {
          // dies del mes actual
          dayNumber = i - startDay + 1;
        }

        const cellDate = new Date(cellYear, cellMonth, dayNumber);
        const cellKey = formatDateKey(cellDate);

        cell.textContent = dayNumber;
        if (isOtherMonth) cell.classList.add("other-month");
        if (cellKey === todayKey) cell.classList.add("today");
        if (cellKey === selectedKey) cell.classList.add("selected");

        // comprovar si hi ha esdeveniments aquest dia
        if (events.some(ev => ev.dateKey === cellKey)) {
          cell.classList.add("has-events");
        }

        cell.addEventListener("click", () => {
          selectedDate = cellDate;
          renderCalendar();
          updateSelectedDateLabel();
          scrollToSelectedDayEvents();
        });

        calendarGrid.appendChild(cell);
      }
    }

    function updateSelectedDateLabel() {
      selectedDateLabel.textContent = formatDatePretty(selectedDate);
    }

    function updateTodayLabel() {
      const today = new Date();
      todayLabel.textContent = `Avui: ${formatDatePretty(today)}`;
    }

    // --- ESDEVENIMENTS ---
    function addEvent(evt) {
      events.push(evt);
      saveEvents();
      renderCalendar();
      renderEventsList();
    }

    function deleteEvent(id) {
      events = events.filter(ev => ev.id !== id);
      saveEvents();
      renderCalendar();
      renderEventsList();
    }

    function renderEventsList() {
      eventsList.innerHTML = "";

      let filtered = [...events];

      // filtre categoria
      if (currentFilterCategory !== "totes") {
        filtered = filtered.filter(ev => ev.category === currentFilterCategory);
      }

      // filtre cerca
      if (currentSearch.trim() !== "") {
        const term = currentSearch.toLowerCase();
        filtered = filtered.filter(ev =>
          ev.title.toLowerCase().includes(term) ||
          (ev.description && ev.description.toLowerCase().includes(term))
        );
      }

      // ordenar per data + hora
      filtered.sort((a, b) => {
        if (a.dateKey === b.dateKey) {
          return (a.time || "").localeCompare(b.time || "");
        }
        return a.dateKey.localeCompare(b.dateKey);
      });

      eventsCount.textContent =
        filtered.length === 1 ? "1 esdeveniment" : `${filtered.length} esdeveniments`;

      if (filtered.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "Encara no hi ha esdeveniments amb aquests filtres.";
        eventsList.appendChild(empty);
        return;
      }

      filtered.forEach(ev => {
        const card = document.createElement("div");
        card.className = "event-card";

        const dateCol = document.createElement("div");
        dateCol.className = "event-date";
        const dateObj = new Date(ev.dateKey + "T00:00");
        dateCol.innerHTML = `<strong>${dateObj.getDate()}</strong> ${monthNames[dateObj.getMonth()].slice(0,3)}<br>${dateObj.getFullYear()}`;

        const mainCol = document.createElement("div");
        const title = document.createElement("div");
        title.className = "event-title";
        title.textContent = ev.title;

        const meta = document.createElement("div");
        meta.className = "event-meta";
        let metaText = "";
        if (ev.time) metaText += `üïí ${ev.time}`;
        if (ev.category && ev.category !== "totes") {
          const catLabel = {
            "estudis": "Estudis",
            "personal": "Personal",
            "projectes": "Projectes",
            "altres": "Altres"
          }[ev.category] || ev.category;
          metaText += (metaText ? " ¬∑ " : "") + catLabel;
        }
        meta.textContent = metaText;

        const desc = document.createElement("div");
        desc.className = "event-desc";
        if (ev.description) desc.textContent = ev.description;

        mainCol.appendChild(title);
        if (metaText) mainCol.appendChild(meta);
        if (ev.description) mainCol.appendChild(desc);

        const actionsCol = document.createElement("div");
        actionsCol.className = "event-actions";
        const delBtn = document.createElement("button");
        delBtn.textContent = "‚úï";
        delBtn.title = "Esborrar";
        delBtn.addEventListener("click", () => {
          if (confirm("Vols esborrar aquest esdeveniment?")) {
            deleteEvent(ev.id);
          }
        });
        actionsCol.appendChild(delBtn);

        card.appendChild(dateCol);
        card.appendChild(mainCol);
        card.appendChild(actionsCol);

        eventsList.appendChild(card);
      });
    }

    function scrollToSelectedDayEvents() {
      const key = formatDateKey(selectedDate);
      const cards = eventsList.querySelectorAll(".event-card");
      for (const card of cards) {
        if (card.textContent.includes(selectedDate.getFullYear())) {
          // prou simple: ja tenim la llista ordenada per data
          break;
        }
      }
    }

    // --- ESDEVENIMENTS FORMULARI ---
    eventForm.addEventListener("submit", e => {
      e.preventDefault();
      const title = titleInput.value.trim();
      if (!title) return;

      const description = descInput.value.trim();
      const time = timeInput.value;
      const category = categorySelect.value === "totes" ? "" : categorySelect.value;

      const dateKey = formatDateKey(selectedDate);

      const newEvent = {
        id: Date.now(),
        dateKey,
        title,
        description,
        time,
        category
      };

      addEvent(newEvent);

      eventForm.reset();
      categorySelect.value = "totes";
    });

    // --- NAVEGAR MESOS ---
    prevMonthBtn.addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });

    nextMonthBtn.addEventListener("click", () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    // --- FILTRES ---
    categoryPills.forEach(pill => {
      pill.addEventListener("click", () => {
        categoryPills.forEach(p => p.classList.remove("active"));
        pill.classList.add("active");
        currentFilterCategory = pill.dataset.filter;
        renderEventsList();
      });
    });

    searchInput.addEventListener("input", () => {
      currentSearch = searchInput.value;
      renderEventsList();
    });

    // --- INICIALITZACI√ì ---
    loadEvents();
    updateTodayLabel();
    updateSelectedDateLabel();
    renderCalendar();
    renderEventsList();
  </script>
</body>
</html>